""" \file SConstruct
   
 \brief Gannet SBA - SCons script for building 
"""

##  (c) 2004-2009 Wim Vanderbauwhede <wim@dcs.gla.ac.uk>


#SetOption('implicit_cache', 1)
import os
from GannetBuilder import build

GANNET_DIR=os.environ["GANNET_DIR"]
wd=ARGUMENTS.get('wd','.')

def isLocal(libname):
    return os.path.exists(wd+'/src/GPRM/Kernel/'+libname+'.cc')

def isLocalFLib(libname):
    return os.path.exists(wd+'/src/GPRM/Kernel/'+libname)    

libnames=ARGUMENTS.get('sclib','')
sclibnames=libnames.split(',')
sclibs=[]
for libname in sclibnames:
    libsrc=''
    if isLocal(libname):     
        if libname!= 'CoreServices':
            libsrc=wd+'/src/GPRM/Kernel/'+libname+'.cc'
        wrappersrc=wd+'/gensrc/Services.cc'
        selectsrc=wd+'/gensrc/SelectWrapper.cc'
#       print libsrc
        sclibs+=[wrappersrc,selectsrc,libsrc]

flibnames=ARGUMENTS.get('flibs','')
flibsnames=flibnames.split(',')

flibs=[]
for libname in flibsnames:
    libsrc=''
    if isLocal(libname):     
        libsrc=wd+'/src/GPRM/Kernel/'+libname
    else:
        libsrc=libname
    flibs.append(libsrc)

sbasources=Split("""
Bytecode.cc
ServiceConfiguration.cc
Packet.cc
Base/ServiceCoreControl.cc
Base/CoreServices.cc
Memory.cc
LookupTable.cc
TaskDescription.cc
Tile.cc
ServiceManager.cc
GatewayTile.cc
Gateway.cc
Interface.cc
Transceiver.cc
System.cc
Runtime.cc
Timings.cc
""")

sbasources = [GANNET_DIR+'/GPRM/src/SBA/'+s for s in sbasources]

build(wd,sclibs+sbasources,flibs)

